import{invariant as e}from"@onflow/util-invariant";import{spawn as t,SUBSCRIBE as n,UNSUBSCRIBE as a,send as r,subscriber as o}from"@onflow/util-actor";import{Transaction as s,SendTransactionRequest as c,AccessAPI as i,GetTransactionRequest as u,ExecuteScriptAtBlockIDRequest as d,ExecuteScriptAtBlockHeightRequest as l,ExecuteScriptAtLatestBlockRequest as g,GetAccountAtBlockHeightRequest as p,GetAccountAtLatestBlockRequest as f,GetEventsForHeightRangeRequest as m,GetEventsForBlockIDsRequest as y,GetBlockByIDRequest as h,GetBlockByHeightRequest as k,GetLatestBlockRequest as I,GetBlockHeaderByIDRequest as w,GetBlockHeaderByHeightRequest as b,GetLatestBlockHeaderRequest as S,GetCollectionByIDRequest as v,PingRequest as E}from"@onflow/protobuf";import{sansPrefix as B,withPrefix as A}from"@onflow/util-address";import{grpc as T}from"@improbable-eng/grpc-web";import{NodeHttpTransport as N}from"@improbable-eng/grpc-web-node-http-transport";import{SHA3 as x}from"sha3";import{encode as L}from"@onflow/rlp";import{template as G}from"@onflow/util-template";export{template as cadence,template as cdc}from"@onflow/util-template";function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},_.apply(this,arguments)}const O='{\n  "tag":"UNKNOWN",\n  "assigns":{},\n  "status":"OK",\n  "reason":null,\n  "accounts":{},\n  "params":{},\n  "arguments":{},\n  "message": {\n    "cadence":null,\n    "refBlock":null,\n    "computeLimit":null,\n    "proposer":null,\n    "payer":null,\n    "authorizations":[],\n    "params":[],\n    "arguments":[]\n  },\n  "proposer":null,\n  "authorizations":[],\n  "payer":null,\n  "events": {\n    "eventType":null,\n    "start":null,\n    "end":null,\n    "blockIds":[]\n  },\n  "transaction": {\n    "id":null\n  },\n  "block": {\n    "id":null,\n    "height":null,\n    "isSealed":null\n  },\n  "account": {\n    "addr":null\n  },\n  "collection": {\n    "id":null\n  }\n}',C=new Set(Object.keys(JSON.parse(O))),D=()=>JSON.parse(O),K="abcdefghijklmnopqrstuvwxyz0123456789".split(""),U=()=>K[~~(Math.random()*K.length)],R=()=>Array.from({length:10},U).join(""),P=e=>null==e,F=e=>"function"==typeof e,z=e=>(e.status="OK",e),H=(e,t)=>(e.status="BAD",e.reason=t,e),j=e=>t=>(t.tag=e,z(t)),$=(t,n={})=>a=>{e("function"==typeof t||"object"==typeof t,"prepAccount must be passed an authorization function or an account object"),e(null!=n.role,"Account must have a role");const r=JSON.parse('{\n  "kind":"ACCOUNT",\n  "tempId":null,\n  "addr":null,\n  "keyId":null,\n  "sequenceNum":null,\n  "signature":null,\n  "signingFunction":null,\n  "resolve":null,\n  "role": {\n    "proposer":false,\n    "authorizer":false,\n    "payer":false,\n    "param":false\n  }\n}'),o=n.role,s=R();return t.authorization&&F(t.authorization)&&(t={resolve:t.authorization}),!t.authorization&&F(t)&&(t={resolve:t}),a.accounts[s]=_({},r,{tempId:s},t,{role:_({},r.role,"object"==typeof t.role?t.role:{},{[o]:!0})}),"authorizer"===o?a.authorizations.push(s):a[o]=s,a},q=e=>t=>{let n=R();return t.message.arguments.push(n),t.arguments[n]=JSON.parse('{\n  "kind":"ARGUMENT",\n  "tempId":null,\n  "value":null,\n  "asArgument":null,\n  "xform":null,\n  "resolve": null,\n  "resolveArgument": null\n}'),t.arguments[n].tempId=n,t.arguments[n].value=e.value,t.arguments[n].asArgument=e.asArgument,t.arguments[n].xform=e.xform,t.arguments[n].resolve=e.resolve,t.arguments[n].resolveArgument=F(e.resolveArgument)?e.resolveArgument.bind(e):e.resolveArgument,z(t)},M=j("SCRIPT"),J=j("TRANSACTION"),W=j("GET_TRANSACTION_STATUS"),Y=j("GET_TRANSACTION"),V=j("GET_ACCOUNT"),X=j("GET_EVENTS"),Z=j("GET_LATEST_BLOCK"),Q=j("GET_BLOCK_BY_ID"),ee=j("GET_BLOCK_BY_HEIGHT"),te=j("PING"),ne=j("GET_BLOCK"),ae=j("GET_BLOCK_HEADER"),re=j("GET_COLLECTION"),oe=e=>t=>t.tag===e,se=oe("UNKNOWN"),ce=oe("SCRIPT"),ie=oe("TRANSACTION"),ue=oe("GET_TRANSACTION_STATUS"),de=oe("GET_TRANSACTION"),le=oe("GET_ACCOUNT"),ge=oe("GET_EVENTS"),pe=oe("GET_LATEST_BLOCK"),fe=oe("GET_BLOCK_BY_ID"),me=oe("GET_BLOCK_BY_HEIGHT"),ye=oe("PING"),he=oe("GET_BLOCK"),ke=oe("GET_BLOCK_HEADER"),Ie=oe("GET_COLLECTION"),we=e=>"OK"===e.status,be=e=>"BAD"===e.status,Se=e=>e.reason,ve=async(e,t=[])=>{try{if(e=(e=>{for(let t of Object.keys(e))if(!C.has(t))throw new Error(`"${t}" is an invalid root level Interaction property.`);return e})(await e),be(e))throw new Error(`Interaction Error: ${e.reason}`);if(!t.length)return e;const[n,...a]=t,r=await n;if(F(r))return ve(r(e),a);if(P(r)||!r)return ve(e,a);if((e=>{if(null===(t=e)||"object"!=typeof t||P(e)||(e=>"number"==typeof e)(e))return!1;var t;for(let t of C)if(!e.hasOwnProperty(t))return!1;return!0})(r))return ve(r,a);throw new Error("Invalid Interaction Composition")}catch(e){throw e}},Ee=(...e)=>{const[t,n]=e;return Array.isArray(t)&&null==n?e=>Ee(e,t):ve(t,n)},Be=e=>e,Ae=(e,t,n)=>null==e.assigns[t]?n:e.assigns[t],Te=(e,t)=>n=>(n.assigns[e]=t,z(n)),Ne=(e,t=Be)=>n=>(n.assigns[e]=t(n.assigns[e],n),z(n)),xe=e=>t=>(delete t.assigns[e],z(t));function Le(e=[]){return Ee(D(),e)}const Ge="config",_e="PUT_CONFIG",Oe="GET_CONFIG",Ce="CONFIG/UPDATED",De=e=>e,Ke={[_e]:(e,t,{key:n,value:a})=>{if(null==n)throw new Error("Missing 'key' for config/put.");e.put(n,a),e.broadcast(Ce,_({},e.all()))},[Oe]:(e,t,{key:n,fallback:a})=>{if(null==n)throw new Error("Missing 'key' for config/get");t.reply(e.get(n,a))},GET_ALL_CONFIG:(e,t)=>{t.reply(_({},e.all()))},UPDATE_CONFIG:(e,t,{key:n,fn:a})=>{if(null==n)throw new Error("Missing 'key' for config/update");e.update(n,a||De),e.broadcast(Ce,_({},e.all()))},DELETE_CONFIG:(e,t,{key:n})=>{if(null==n)throw new Error("Missing 'key' for config/delete");e.delete(n),e.broadcast(Ce,_({},e.all()))},CLEAR_CONFIG:(e,t)=>{let n=Object.keys(e.all());for(let t of n)e.delete(t);e.broadcast(Ce,_({},e.all()))},WHERE_CONFIG:(e,t,{pattern:n})=>{if(null==n)throw new Error("Missing 'pattern' for config/where");t.reply(e.where(n))},[n]:(e,t)=>{e.subscribe(t.from),e.send(t.from,Ce,_({},e.all()))},[a]:(e,t)=>{e.unsubscribe(t.from)}};function Ue(e,t){return r(Ge,_e,{key:e,value:t}),Me()}function Re(e,t){return r(Ge,Oe,{key:e,fallback:t},{expectReply:!0,timeout:10})}async function Pe(e=[],t){if(!e.length)return t;const[n,...a]=e,r=await Re(n);return null==r?Pe(a,t):r}function Fe(){return r(Ge,"GET_ALL_CONFIG",null,{expectReply:!0,timeout:10})}function ze(e,t=De){return r(Ge,"UPDATE_CONFIG",{key:e,fn:t}),Me()}function He(e){return r(Ge,"DELETE_CONFIG",{key:e}),Me()}function je(e){return r(Ge,"WHERE_CONFIG",{pattern:e},{expectReply:!0,timeout:10})}function $e(e){return o(Ge,()=>t(Ke,Ge),e)}function qe(){return r(Ge,"CLEAR_CONFIG")}function Me(e){return null!=e&&"object"==typeof e&&Object.keys(e).map(t=>Ue(t,e[t])),{put:Ue,get:Re,all:Fe,first:Pe,update:ze,delete:He,where:je,subscribe:$e,overload:We}}t(Ke,Ge),Me.put=Ue,Me.get=Re,Me.all=Fe,Me.first=Pe,Me.update=ze,Me.delete=He,Me.where=je,Me.subscribe=$e,Me.overload=We;const Je=e=>e;function We(e={},t=Je){return new Promise(async(n,a)=>{const r=await Fe();try{Me(e);var o=await t(await Fe());await qe(),await Me(r),n(o)}catch(e){await qe(),await Me(r),a(e)}})}const Ye=()=>JSON.parse('{\n    "tag":null,\n    "transaction":null,\n    "transactionStatus":null,\n    "transactionId":null,\n    "encodedData":null,\n    "events":null,\n    "account":null,\n    "block":null,\n    "blockHeader":null,\n    "latestBlock":null,\n    "collection":null\n}');async function Ve(e,t,n){const a=await Me().get("grpc.metadata",{});return new Promise((r,o)=>{T.unary(t,{request:n,host:e,metadata:new T.Metadata(a),onEnd:({status:e,statusMessage:t,message:n})=>{e===T.Code.OK?r(n):o(new Error(t))}})})}T.setDefaultTransport(N());const Xe=e=>Buffer.from(e,"hex"),Ze=e=>Buffer.from(e.padStart(16,0),"hex"),Qe={0:"UNKNOWN",1:"PENDING",2:"FINALIZED",3:"EXECUTED",4:"SEALED",5:"EXPIRED"},et=e=>{if(null!=e)return Qe[String(e)]},tt=e=>Buffer.from(e).toString("hex"),nt=e=>Buffer.from(JSON.stringify(e),"utf8");function at(e,t){let n=Ye();return n.tag=e.tag,n.encodedData=JSON.parse(Buffer.from(t.getValue_asU8()).toString("utf8")),n}const rt=e=>Buffer.from(e).toString("hex"),ot=e=>Buffer.from(e.padStart(16,0),"hex");function st(e,t){let n=Ye();n.tag=e.tag;const a=t.getAccount();let r;const o=(r=a.getContractsMap())?r.getEntryList().reduce((e,t)=>_({},e,{[t[0]]:Buffer.from(t[1]||new UInt8Array).toString("utf8")}),{}):{};return n.account={address:A(rt(a.getAddress_asU8())),balance:a.getBalance(),code:Buffer.from(a.getCode_asU8()||new UInt8Array).toString("utf8"),contracts:o,keys:a.getKeysList().map(e=>({index:e.getIndex(),publicKey:rt(e.getPublicKey_asU8()),signAlgo:e.getSignAlgo(),hashAlgo:e.getHashAlgo(),weight:e.getWeight(),sequenceNumber:e.getSequenceNumber(),revoked:e.getRevoked()}))},n}const ct=e=>Buffer.from(e).toString("hex");function it(e,t){let n=Ye();n.tag=e.tag;const a=t.getResultsList();return n.events=a.reduce((e,t)=>{const n=ct(t.getBlockId_asU8()),a=t.getBlockHeight(),r=t.getBlockTimestamp().toDate().toISOString();return t.getEventsList().forEach(t=>{e.push({blockId:n,blockHeight:a,blockTimestamp:r,type:t.getType(),transactionId:ct(t.getTransactionId_asU8()),transactionIndex:t.getTransactionIndex(),eventIndex:t.getEventIndex(),payload:JSON.parse(Buffer.from(t.getPayload_asU8()).toString("utf8"))})}),e},[]),n}const ut=e=>Buffer.from(e).toString("hex");function dt(e,t){const n=t.getBlock(),a=n.getCollectionGuaranteesList(),r=n.getBlockSealsList(),o=n.getSignaturesList().map(ut),s=Ye();return s.tag=e.tag,s.block={id:ut(n.getId_asU8()),parentId:ut(n.getParentId_asU8()),height:n.getHeight(),timestamp:n.getTimestamp().toDate().toISOString(),collectionGuarantees:a.map(e=>({collectionId:ut(e.getCollectionId_asU8()),signatures:e.getSignaturesList().map(ut)})),blockSeals:r.map(e=>({blockId:ut(e.getBlockId_asU8()),executionReceiptId:ut(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList().map(ut),resultApprovalSignatures:e.getResultApprovalSignaturesList().map(ut)})),signatures:o},s}const lt=e=>Buffer.from(e).toString("hex");function gt(e,t){const n=t.getBlock(),a=Ye();return a.tag=e.tag,a.blockHeader={id:lt(n.getId_asU8()),parentId:lt(n.getParentId_asU8()),height:n.getHeight(),timestamp:n.getTimestamp().toDate().toISOString()},a}const pt=e=>Buffer.from(e).toString("hex"),ft=e=>Buffer.from(e).toString("hex"),mt=e=>Buffer.from(e).toString("hex"),yt=e=>Buffer.from(e).toString("hex"),ht=async(t,n={})=>{switch(n.node=n.node||await Me().get("accessNode.api"),e(n.node,'SDK Send Error: Either opts.node or "accessNode.api" in config must be defined.'),t=await t,!0){case ie(t):return n.sendTransaction?n.sendTransaction(t,n):async function(t,n={}){e(n.node,"SDK Send Transaction Error: opts.node must be defined.");const a=n.unary||Ve;t=await t;const r=new s;r.setScript((e=>Buffer.from(e,"utf8"))(t.message.cadence)),r.setGasLimit(t.message.computeLimit),r.setReferenceBlockId(t.message.refBlock?Xe(t.message.refBlock):null),r.setPayer(Ze(B(t.accounts[t.payer].addr))),t.message.arguments.forEach(e=>r.addArguments((e=>Buffer.from(JSON.stringify(e),"utf8"))(t.arguments[e].asArgument))),t.authorizations.map(e=>t.accounts[e].addr).reduce((e,t)=>e.find(e=>e===t)?e:[...e,t],[]).forEach(e=>r.addAuthorizers(Ze(B(e))));const o=new s.ProposalKey;o.setAddress(Ze(B(t.accounts[t.proposer].addr))),o.setKeyId(t.accounts[t.proposer].keyId),o.setSequenceNumber(t.accounts[t.proposer].sequenceNum),r.setProposalKey(o);for(let e of Object.values(t.accounts))try{if(!e.role.payer&&null!=e.signature){const t=new s.Signature;t.setAddress(Ze(B(e.addr))),t.setKeyId(e.keyId),t.setSignature(Xe(e.signature)),r.addPayloadSignatures(t)}}catch(n){throw console.error("Trouble applying payload signature",{acct:e,ix:t}),n}for(let e of Object.values(t.accounts))try{if(e.role.payer&&null!=e.signature){const t=new s.Signature;t.setAddress(Ze(B(e.addr))),t.setKeyId(e.keyId),t.setSignature(Xe(e.signature)),r.addEnvelopeSignatures(t)}}catch(n){throw console.error("Trouble applying envelope signature",{acct:e,ix:t}),n}const u=new c;u.setTransaction(r);var d=Date.now();const l=await a(n.node,i.SendTransaction,u);var g=Date.now();let p=Ye();var f;return p.tag=t.tag,p.transactionId=(f=l.getId_asU8(),Buffer.from(f).toString("hex")),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("FLOW::TX",{detail:{txId:p.transactionId,delta:g-d}})),p}(t,n);case ue(t):return n.sendGetTransactionStatus?n.sendGetTransactionStatus(t,n):async function(t,n={}){e(n.node,"SDK Send Get Transaction Status Error: opts.node must be defined.");const a=n.unary||Ve;t=await t;const r=new u;r.setId(Buffer.from(t.transaction.id,"hex"));const o=await a(n.node,i.GetTransactionResult,r);let s=o.getEventsList(),c=Ye();const d=o.getStatus();return c.tag=t.tag,c.transactionStatus={status:d,statusString:et(d),statusCode:o.getStatusCode(),errorMessage:o.getErrorMessage(),events:s.map(e=>{return{type:e.getType(),transactionId:(t=e.getTransactionId_asU8(),Buffer.from(t).toString("hex")),transactionIndex:e.getTransactionIndex(),eventIndex:e.getEventIndex(),payload:JSON.parse(Buffer.from(e.getPayload_asU8()).toString("utf8"))};var t})},c}(t,n);case de(t):return n.sendGetTransaction?n.sendGetTransaction(t,n):async function(t,n={}){e(n.node,"SDK Send Get Transaction Error: opts.node must be defined.");const a=n.unary||Ve;t=await t;const r=new u;r.setId(Buffer.from(t.transaction.id,"hex"));const o=await a(n.node,i.GetTransaction,r);let s=Ye();s.tag=t.tag;const c=e=>({address:tt(e.getAddress_asU8()),keyId:e.getKeyId(),signature:tt(e.getSignature_asU8())});let d=o.getTransaction();var l;return s.transaction={script:Buffer.from(d.getScript_asU8()).toString("utf8"),args:d.getArgumentsList().map(e=>JSON.parse(Buffer.from(e).toString("utf8"))),referenceBlockId:tt(d.getReferenceBlockId_asU8()),gasLimit:d.getGasLimit(),proposalKey:(l=d.getProposalKey(),{address:tt(l.getAddress_asU8()),keyId:l.getKeyId(),sequenceNumber:l.getSequenceNumber()}),payer:tt(d.getPayer_asU8()),authorizers:d.getAuthorizersList().map(tt),payloadSignatures:d.getPayloadSignaturesList().map(c),envelopeSignatures:d.getEnvelopeSignaturesList().map(c)},s}(t,n);case ce(t):return n.sendExecuteScript?n.sendExecuteScript(t,n):async function(t,n={}){return e(n.node,"SDK Send Execute Script Error: opts.node must be defined."),(t=await t).block.id?await async function(e,t){const n=t.unary||Ve,a=new d;a.setBlockId(Buffer.from(e.block.id,"hex"));const r=Buffer.from(e.message.cadence,"utf8");e.message.arguments.forEach(t=>a.addArguments(nt(e.arguments[t].asArgument))),a.setScript(r);const o=await n(t.node,i.ExecuteScriptAtBlockID,a);return at(e,o)}(t,n):t.block.height?await async function(e,t){const n=t.unary||Ve,a=new l;a.setBlockHeight(Number(e.block.height));const r=Buffer.from(e.message.cadence,"utf8");e.message.arguments.forEach(t=>a.addArguments(nt(e.arguments[t].asArgument))),a.setScript(r);const o=await n(t.node,i.ExecuteScriptAtBlockHeight,a);return at(e,o)}(t,n):await async function(e,t){const n=t.unary||Ve,a=new g,r=Buffer.from(e.message.cadence,"utf8");e.message.arguments.forEach(t=>a.addArguments(nt(e.arguments[t].asArgument))),a.setScript(r);const o=await n(t.node,i.ExecuteScriptAtLatestBlock,a);return at(e,o)}(t,n)}(t,n);case le(t):return n.sendGetAccount?n.sendGetAccount(t,n):async function(t,n={}){return e(n.node,"SDK Send Get Account Error: opts.node must be defined."),null!==(t=await t).block.height?await async function(e,t){const n=t.unary||Ve,a=new p;return a.setBlockHeight(Number(e.block.height)),a.setAddress(ot(B(e.account.addr))),st(e,await n(t.node,i.GetAccountAtBlockHeight,a))}(t,n):await async function(e,t){const n=t.unary||Ve,a=new f;return a.setAddress(ot(B(e.account.addr))),st(e,await n(t.node,i.GetAccountAtLatestBlock,a))}(t,n)}(t,n);case ge(t):return n.sendGetEvents?n.sendGetEvents(t,n):async function(t,n={}){e(n.node,"SDK Send Get Events Error: opts.node must be defined.");const a=null!==(t=await t).events.start,r=Array.isArray(t.events.blockIds)&&t.events.blockIds.length>0;return e(a||r,"SendGetEventsError: Unable to determine which get events request to send. Either a block height range, or block IDs must be specified."),a?await async function(e,t){const n=t.unary||Ve,a=new m;return a.setType(e.events.eventType),a.setStartHeight(Number(e.events.start)),a.setEndHeight(Number(e.events.end)),it(e,await n(t.node,i.GetEventsForHeightRange,a))}(t,n):await async function(e,t){const n=t.unary||Ve,a=new y;return a.setType(e.events.eventType),e.events.blockIds.forEach(e=>a.addBlockIds(Buffer.from(e,"hex"))),it(e,await n(t.node,i.GetEventsForBlockIDs,a))}(t,n)}(t,n);case pe(t):return n.sendGetLatestBlock?n.sendGetLatestBlock(t,n):async function(t,n={}){e(n.node,"SDK Send Get Latest Block Error: opts.node must be defined."),t=await t;const a=new I;t.latestBlock&&t.latestBlock.isSealed&&(a.setIsSealed(t.latestBlock.isSealed),console.error("\n          %c@onflow/send Deprecation Notice\n          ========================\n\n          Operating upon data of the latestBlock field of the interaction object is deprecated and will no longer be recognized in future releases of @onflow/send.\n          Find out more here: https://github.com/onflow/flow-js-sdk/blob/master/packages/send/WARNINGS.md#0001-Deprecating-latestBlock-field\n\n          =======================\n        ".replace(/\n\s+/g,"\n").trim(),"font-weight:bold;font-family:monospace;")),t.block&&t.block.isSealed&&a.setIsSealed(t.block.isSealed);const r=(await Ve(n.node,i.GetLatestBlock,a)).getBlock(),o=r.getCollectionGuaranteesList(),s=r.getBlockSealsList(),c=r.getSignaturesList(),u=Ye();return u.tag=t.tag,u.block={id:pt(r.getId_asU8()),parentId:pt(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:o.map(e=>({collectionId:pt(e.getCollectionId_asU8()),signatures:e.getSignaturesList()})),blockSeals:s.map(e=>({blockId:pt(e.getBlockId_asU8()),executionReceiptId:pt(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()})),signatures:c},u}(t,n);case he(t):return n.sendGetBlock?n.sendGetBlock(t,n):async function(t,n={}){e(n.node,"SDK Send Get Block Error: opts.node must be defined.");const a=null!==(t=await t).block.height;return null!==t.block.id?await async function(e,t){const n=t.unary||Ve,a=new h;return a.setId(Buffer.from(e.block.id,"hex")),dt(e,await n(t.node,i.GetBlockByID,a))}(t,n):a?await async function(e,t){const n=t.unary||Ve,a=new k;return a.setHeight(Number(e.block.height)),dt(e,await n(t.node,i.GetBlockByHeight,a))}(t,n):await async function(e,t){var n;const a=t.unary||Ve,r=new I;return null!=(n=e.block)&&n.isSealed&&r.setIsSealed(e.block.isSealed),dt(e,await a(t.node,i.GetLatestBlock,r))}(t,n)}(t,n);case ke(t):return n.sendGetBlockHeader?n.sendGetBlockHeader(t,n):async function(t,n={}){e(n.node,"SDK Send Get Block Header Error: opts.node must be defined.");const a=null!==(t=await t).block.height;return null!==t.block.id?await async function(e,t){const n=t.unary||Ve,a=new w;return a.setId(Buffer.from(e.block.id,"hex")),gt(e,await n(t.node,i.GetBlockHeaderByID,a))}(t,n):a?await async function(e,t){const n=t.unary||Ve,a=new b;return a.setHeight(Number(e.block.height)),gt(e,await n(t.node,i.GetBlockHeaderByHeight,a))}(t,n):await async function(e,t){var n;const a=t.unary||Ve,r=new S;return null!=(n=e.block)&&n.isSealed&&r.setIsSealed(e.block.isSealed),gt(e,await a(t.node,i.GetLatestBlockHeader,r))}(t,n)}(t,n);case fe(t):return n.sendGetBlockById?n.sendGetBlockById(t,n):async function(t,n={}){e(n.node,"SDK Send Get Block By ID Error: opts.node must be defined."),t=await t;const a=new h;a.setId(Buffer.from(t.block.id,"hex"));const r=(await Ve(n.node,i.GetBlockByID,a)).getBlock(),o=r.getCollectionGuaranteesList(),s=r.getBlockSealsList(),c=r.getSignaturesList(),u=Ye();return u.tag=t.tag,u.block={id:ft(r.getId_asU8()),parentId:ft(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:o.map(e=>({collectionId:ft(e.getCollectionId_asU8()),signatures:e.getSignaturesList()})),blockSeals:s.map(e=>({blockId:ft(e.getBlockId_asU8()),executionReceiptId:ft(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()})),signatures:c},u}(t,n);case me(t):return n.sendGetBlockByHeight?n.sendGetBlockByHeight(t,n):async function(t,n={}){e(n.node,"SDK Send Get Block By Height Error: opts.node must be defined."),t=await t;const a=new k;a.setHeight(Number(t.block.height));const r=(await Ve(n.node,i.GetBlockByHeight,a)).getBlock(),o=r.getCollectionGuaranteesList(),s=r.getBlockSealsList(),c=r.getSignaturesList(),u=Ye();return u.tag=t.tag,u.block={id:mt(r.getId_asU8()),parentId:mt(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:o.map(e=>({collectionId:mt(e.getCollectionId_asU8()),signatures:e.getSignaturesList()})),blockSeals:s.map(e=>({blockId:mt(e.getBlockId_asU8()),executionReceiptId:mt(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()})),signatures:c},u}(t,n);case Ie(t):return n.sendGetCollection?n.sendGetCollection(t,n):async function(t,n={}){e(n.node,"SDK Send Get Collection Error: opts.node must be defined.");const a=n.unary||Ve;t=await t;const r=new v;r.setId(Buffer.from(t.collection.id,"hex"));const o=(await a(n.node,i.GetCollectionByID,r)).getCollection(),s=Ye();return s.tag=t.tag,s.collection={id:yt(o.getId_asU8()),transactionIds:o.getTransactionIdsList().map(yt)},s}(t,n);case ye(t):return n.sendPing?n.sendPing(t,n):async function(t,n={}){e(n.node,"SDK Send Ping Error: opts.node must be defined.");const a=n.unary||Ve;t=await t;const r=new E;await a(n.node,i.Ping,r);let o=Ye();return o.tag=t.tag,o}(t,n);default:return t}};function kt(e=null){return Ee([ne,t=>(t.block.isSealed=e,z(t))])}function It(e){return Ee([V,t=>(t.account.addr=B(e),z(t))])}const wt=async(e,t,n)=>{try{return Number(e)}catch(e){throw new Error(`Decode Number Error : ${n.join(".")}`)}},bt=async e=>e,St=async(e,t,n)=>{const a=await e.fields.reduce(async(e,a)=>((e=await e)[a.name]=await Bt(a.value,t,[...n,a.name]),e),Promise.resolve({})),r=e.id&&Et(t,e.id);return r?await r(a):a},vt={UInt:wt,Int:wt,UInt8:wt,Int8:wt,UInt16:wt,Int16:wt,UInt32:wt,Int32:wt,UInt64:wt,Int64:wt,UInt128:wt,Int128:wt,UInt256:wt,Int256:wt,Word8:wt,Word16:wt,Word32:wt,Word64:wt,UFix64:bt,Fix64:bt,String:bt,Character:bt,Bool:bt,Address:bt,Void:async()=>null,Optional:async(e,t,n)=>e?await Bt(e,t,n):null,Reference:async e=>({address:e.address,type:e.type}),Array:async(e,t,n)=>await Promise.all(e.map(e=>new Promise(async a=>a(await Bt(e,t,[...n,e.type]))))),Dictionary:async(e,t,n)=>await e.reduce(async(e,a)=>((e=await e)[await Bt(a.key,t,[...n,a.key])]=await Bt(a.value,t,[...n,a.key]),e),Promise.resolve({})),Event:St,Resource:St,Struct:St,Enum:St,Type:async e=>e.staticType,Path:async e=>({domain:e.domain,identifier:e.identifier}),Capability:async e=>({path:e.path,address:e.address,borrowType:e.borrowType})},Et=(e,t)=>{const n=Object.keys(e).find(e=>/^\/.*\/$/.test(e)?new RegExp(e.substring(1,e.length-1)).test(t):e===t);return t&&n&&e[n]},Bt=async(e,t,n)=>{let a=Et(t,e.type);if(!a)throw new Error(`Undefined Decoder Error: ${e.type}@${n.join(".")}`);return await a(e.value,t,n)},At=async(e,t={},n=[])=>{let a=_({},vt,t);return await Bt(e,a,n)},Tt=async(e,t={})=>{let n=_({},vt,t);return e.encodedData?await At(e.encodedData,n):e.transactionStatus?_({},e.transactionStatus,{events:await Promise.all(e.transactionStatus.events.map(async function(e){return{type:e.type,transactionId:e.transactionId,transactionIndex:e.transactionIndex,eventIndex:e.eventIndex,data:await At(e.payload,n)}}))}):e.transaction?e.transaction:e.events?await Promise.all(e.events.map(async function(e){return{blockId:e.blockId,blockHeight:e.blockHeight,blockTimestamp:e.blockTimestamp,type:e.type,transactionId:e.transactionId,transactionIndex:e.transactionIndex,eventIndex:e.eventIndex,data:await At(e.payload,n)}})):e.account?e.account:e.block?e.block:e.blockHeader?e.blockHeader:e.latestBlock?(console.error("\n          %c@onflow/decode Deprecation Notice\n          ========================\n\n          Operating upon data of the latestBlock field of the response object is deprecated and will no longer be recognized in future releases of @onflow/decode.\n          Find out more here: https://github.com/onflow/flow-js-sdk/blob/master/packages/decode/WARNINGS.md#0001-Deprecating-latestBlock-field\n\n          =======================\n        ".replace(/\n\s+/g,"\n").trim(),"font-weight:bold;font-family:monospace;"),e.latestBlock):e.transactionId?e.transactionId:e.collection?e.collection:null};function Nt(e){return async t=>ie(t)?(t.message.refBlock||(t.message.refBlock=await async function(e){var t;return t=await Ee(D(),[kt()]),t=await ht(t,e),(t=await Tt(t)).id}(e)),z(t)):z(t)}const xt=e=>"function"==typeof e,Lt=e=>"string"==typeof e;async function Gt(t){if(ie(t)||ce(t)){var n=Ae(t,"ix.cadence");e(xt(n)||Lt(n),"Cadence needs to be a function or a string."),xt(n)&&(n=await n({})),e(Lt(n),"Cadence needs to be a string at this point."),t.message.cadence=await Me().where(/^0x/).then(e=>Object.entries(e).reduce((e,[t,n])=>{const a=new RegExp("(\\b"+t+"\\b)","g");return e.replace(a,n)},n))}return t}const _t=e=>"function"==typeof e;function Ot(t){return e(null!=typeof t.xform,`No type specified for argument: ${t.value}`),_t(t.xform)?t.xform(t.value):_t(t.xform.asArgument)?t.xform.asArgument(t.value):void e(!1,"Invalid Argument",t)}async function Ct(t,n=3){return e(n>0,`Argument Resolve Recursion Limit Exceeded for Arg: ${t.tempId}`),_t(t.resolveArgument)?Ct(await t.resolveArgument(),n-1):t}async function Dt(e){if(ie(e)||ce(e))for(let[t,n]of Object.entries(e.arguments)){const a=await Ct(n);e.arguments[t].asArgument=Ot(a)}return e}const Kt=e=>zt(Jt(Wt(e))),Ut=e=>zt(Jt(Yt(e))),Rt=(e,t)=>Buffer.from(e.padStart(2*t,0),"hex"),Pt=(Ft=Buffer.from("FLOW-V0.0-transaction").toString("hex"),Buffer.from(Ft.padEnd(64,0),"hex")).toString("hex");var Ft;const zt=e=>Pt+e,Ht=e=>Rt(e,8),jt=e=>Rt(e,32),$t=e=>Buffer.from(JSON.stringify(e),"utf8"),qt=e=>Buffer.from(e,"utf8"),Mt=e=>Buffer.from(e,"hex"),Jt=e=>L(e).toString("hex"),Wt=e=>(Zt(e),[qt(e.cadence),e.arguments.map($t),jt(e.refBlock),e.computeLimit,Ht(e.proposalKey.address),e.proposalKey.keyId,e.proposalKey.sequenceNum,Ht(e.payer),e.authorizers.map(Ht)]),Yt=e=>(Qt(e),[Wt(e),Vt(e)]),Vt=e=>{const t=Xt(e);return e.payloadSigs.map(e=>({signerIndex:t.get(e.address),keyId:e.keyId,sig:e.sig})).sort((e,t)=>e.signerIndex>t.signerIndex?1:e.signerIndex<t.signerIndex?-1:e.keyId>t.keyId?1:e.keyId<t.keyId?-1:void 0).map(e=>[e.signerIndex,e.keyId,Mt(e.sig)])},Xt=e=>{const t=new Map;let n=0;const a=e=>{t.has(e)||(t.set(e,n),n++)};return a(e.proposalKey.address),a(e.payer),e.authorizers.forEach(a),t},Zt=e=>{rn.forEach(t=>ln(e,t)),on.forEach(t=>ln(e.proposalKey,t,"proposalKey"))},Qt=e=>{sn.forEach(t=>ln(e,t)),e.payloadSigs.forEach((e,t)=>{cn.forEach(n=>ln(e,n,"payloadSigs",t))})},en=e=>"number"==typeof e,tn=e=>"string"==typeof e,nn=e=>null!==e&&"object"==typeof e,an=e=>nn(e)&&e instanceof Array,rn=[{name:"cadence",check:tn},{name:"arguments",check:an},{name:"refBlock",check:tn,defaultVal:"0"},{name:"computeLimit",check:en},{name:"proposalKey",check:nn},{name:"payer",check:tn},{name:"authorizers",check:an}],on=[{name:"address",check:tn},{name:"keyId",check:en},{name:"sequenceNum",check:en}],sn=[{name:"payloadSigs",check:an}],cn=[{name:"address",check:tn},{name:"keyId",check:en},{name:"sig",check:tn}],un=[{name:"envelopeSigs",check:an}],dn=[{name:"address",check:tn},{name:"keyId",check:en},{name:"sig",check:tn}],ln=(e,t,n,a)=>{const{name:r,check:o,defaultVal:s}=t;if(null==e[r]&&null!=s&&(e[r]=s),null==e[r])throw pn(r,n,a);if(!o(e[r]))throw fn(r,n,a)},gn=(e,t,n)=>t?null==n?`${t}.${e}`:`${t}.${n}.${e}`:e,pn=(e,t,n)=>new Error(`Missing field ${gn(e,t,n)}`),fn=(e,t,n)=>new Error(`Invalid field ${gn(e,t,n)}`);function mn(e){let t=new Set(e.authorizations);return t.add(e.proposer),t.delete(e.payer),Array.from(t)}function yn(e){let t=new Set([e.payer]);return Array.from(t)}const hn=e=>({cadence:e.message.cadence,refBlock:e.message.refBlock||null,computeLimit:e.message.computeLimit,arguments:e.message.arguments.map(t=>e.arguments[t].asArgument),proposalKey:{address:A(e.accounts[e.proposer].addr),keyId:e.accounts[e.proposer].keyId,sequenceNum:e.accounts[e.proposer].sequenceNum},payer:A(e.accounts[e.payer].addr),authorizers:(()=>{const t=e.authorizations.map(t=>A(e.accounts[t].addr)).reduce((e,t)=>e.find(e=>e===t)?e:[...e,t],[]);return t[0]?t:[]})(),payloadSigs:mn(e).map(t=>({address:A(e.accounts[t].addr),keyId:e.accounts[t].keyId,sig:e.accounts[t].signature})),envelopeSigs:yn(e).map(t=>({address:A(e.accounts[t].addr),keyId:e.accounts[t].keyId,sig:e.accounts[t].signature}))}),kn=e=>(e=>(e=>{const t=new x(256);return t.update(Buffer.from(e,"hex")),t.digest().toString("hex")})(Jt((e=>{(e=>{rn.forEach(t=>ln(e,t)),on.forEach(t=>ln(e.proposalKey,t,"proposalKey")),sn.forEach(t=>ln(e,t)),e.payloadSigs.forEach((e,t)=>{cn.forEach(n=>ln(e,n,"payloadSigs",t))}),un.forEach(t=>ln(e,t)),e.envelopeSigs.forEach((e,t)=>{dn.forEach(n=>ln(e,n,"envelopeSigs",t))})})(e);const t=Xt(e),n=e=>e.map(({address:e,keyId:n,sig:a})=>({signerIndex:t.get(e),keyId:n,sig:a})).sort((e,t)=>e.signerIndex>t.signerIndex?1:e.signerIndex<t.signerIndex?-1:e.keyId>t.keyId?1:e.keyId<t.keyId?-1:void 0).map(e=>[e.signerIndex,e.keyId,Mt(e.sig)]);return[[qt(e.cadence),e.arguments.map($t),jt(e.refBlock),e.computeLimit,Ht(B(e.proposalKey.address)),e.proposalKey.keyId,e.proposalKey.sequenceNum,Ht(B(e.payer)),e.authorizers.map(e=>Ht(B(e)))],n(e.payloadSigs),n(e.envelopeSigs)]})(e))))(e);function In(e,t){try{return{f_type:"PreSignable",f_vsn:"1.0.1",roles:e.role,cadence:t.message.cadence,args:t.message.arguments.map(e=>t.arguments[e].asArgument),data:{},interaction:t,voucher:hn(t)}}catch(e){throw console.error("buildPreSignable",e),e}}async function wn(t,n,a,r=3){e(r,"Account Resolve Recursion Limit Exceeded",{ix:t,accounts:n});let o=[];for(let e of n){var s=a||e;"function"==typeof e.resolve&&(e=await e.resolve(e,In(e,t))),Array.isArray(e)?await wn(t,e,s,r-1):(null!=e.addr&&null!=e.keyId&&(e.tempId=`${e.addr}-${e.keyId}`),t.accounts[e.tempId]=t.accounts[e.tempId]||e,t.accounts[e.tempId].role.proposer=t.accounts[e.tempId].role.proposer||e.role.proposer,t.accounts[e.tempId].role.payer=t.accounts[e.tempId].role.payer||e.role.payer,t.accounts[e.tempId].role.authorizer=t.accounts[e.tempId].role.authorizer||e.role.authorizer,t.accounts[e.tempId].role.proposer&&t.proposer===s.tempId&&(t.proposer=e.tempId),t.accounts[e.tempId].role.payer&&t.payer===s.tempId&&(t.payer=e.tempId),t.accounts[e.tempId].role.authorizer&&(a?o=Array.from(new Set([...o,e.tempId])):t.authorizations=t.authorizations.map(t=>t===s.tempId?e.tempId:t))),s.tempId!=e.tempId&&delete t.accounts[s.tempId]}a&&(t.authorizations=t.authorizations.map(e=>e===a.tempId?o:e).reduce((e,t)=>Array.isArray(t)?[...e,...t]:[...e,t],[]))}async function bn(e){if(ie(e))try{await wn(e,Object.values(e.accounts)),await wn(e,Object.values(e.accounts))}catch(e){throw console.error("=== SAD PANDA ===\n\n",e,"\n\n=== SAD PANDA ==="),e}return e}async function Sn(e){if(ie(e))try{let t=mn(e);const n=Kt(En(e));await Promise.all(t.map(vn(e,n)));let a=yn(e);const r=Ut(_({},En(e),{payloadSigs:t.map(t=>({address:e.accounts[t].addr,keyId:e.accounts[t].keyId,sig:e.accounts[t].signature}))}));await Promise.all(a.map(vn(e,r)))}catch(t){throw console.error("Signatures",t,{ix:e}),t}return e}function vn(e,t){return async function(n){const a=e.accounts[n];if(null!=a.signature)return;const{signature:r}=await a.signingFunction(function(e,t,n){try{return{f_type:"Signable",f_vsn:"1.0.1",message:t,addr:B(e.addr),keyId:e.keyId,roles:e.role,cadence:n.message.cadence,args:n.message.arguments.map(e=>n.arguments[e].asArgument),data:{},interaction:n,voucher:hn(n)}}catch(e){throw console.error("buildSignable",e),e}}(a,t,e));e.accounts[n].signature=r}}function En(e){return{cadence:e.message.cadence,refBlock:e.message.refBlock||null,computeLimit:e.message.computeLimit,arguments:e.message.arguments.map(t=>e.arguments[t].asArgument),proposalKey:{address:B(e.accounts[e.proposer].addr),keyId:e.accounts[e.proposer].keyId,sequenceNum:e.accounts[e.proposer].sequenceNum},payer:B(e.accounts[e.payer].addr),authorizers:e.authorizations.map(t=>B(e.accounts[t].addr)).reduce((e,t)=>e.find(e=>e===t)?e:[...e,t],[])}}async function Bn(e){const t=Ae(e,"ix.validators",[]);return Ee(e,t.map(e=>t=>e(t,{Ok:z,Bad:H})))}async function An(e){for(let t of Object.keys(e.accounts))e.accounts[t].addr=B(e.accounts[t].addr);return e}const Tn=e=>e,Nn=(e,t=Tn)=>async n=>(await Me.get(`debug.${e}`)&&await t(n,(...t)=>{console.log(`debug[${e}] ---\n`,...t,"\n\n\n---")},e=>["\nAccounts:",{proposer:e.proposer,authorizations:e.authorizations,payer:e.payer},"\n\nDetails:",e.accounts].filter(Boolean)),n),xn=Ee([Gt,Nn("cadence",(e,t)=>t(e.message.cadence)),Dt,Nn("arguments",(e,t)=>t(e.message.arguments,e.message)),bn,Nn("accounts",(e,t,n)=>t(...n(e))),async function(e){if(ie(e)&&null==e.message.refBlock){const t=await Me.first(["sdk.transport","sdk.send"],ht);e.message.refBlock=(await t(Le([kt()])).then(Tt)).id}return e},async function(t){if(ie(t)){const a=await Me.first(["sdk.transport","sdk.send"],ht);var n=Object.values(t.accounts).find(e=>e.role.proposer);e(n,"Transactions require a proposer"),null==n.sequenceNum&&(t.accounts[n.tempId].sequenceNum=await a(await Le([It(n.addr)])).then(Tt).then(e=>e.keys).then(e=>e.find(e=>e.index===n.keyId)).then(e=>e.sequenceNumber))}return t},Sn,Nn("signatures",(e,t,n)=>t(...n(e))),An,Bn,async function(e){const t=Ae(e,"ix.pre-send-check");return F(t)&&await t(hn(e)),e},Nn("resolved",(e,t)=>t(e))]),Ln=async(e=[],t={})=>{const n=await Me.first(["sdk.transport","sdk.send"],t.send||ht),a=await Me.first(["sdk.resolve"],t.resolve||xn);return Array.isArray(e)&&(e=Ee(D(),e)),n(await a(e),t)};async function Gn(e){const t=await Me().where(/^decoder\./),n=Object.entries(t).map(([e,t])=>[e=`/${e.replace(/^decoder\./,"")}$/`,t]);return Tt(e,Object.fromEntries(n))}class _n extends Error{constructor(e){super(`\n        Encode Message From Signable Error: Unable to determine message encoding for signer addresss: ${e}. \n        Please ensure the address: ${e} is intended to sign the given transaction as specified by the transaction signable.\n      `.trim()),this.name="Unable To Determine Message Encoding For Signer Addresss"}}const On=(e,t)=>{let n=(e=>{let t=new Set(e.authorizers);return t.add(e.proposalKey.address),t.delete(e.payer),Array.from(t).map(A)})(e.voucher),a=(e=>{let t=new Set([e.payer]);return Array.from(t).map(A)})(e.voucher);const r=n.includes(A(t)),o=a.includes(A(t));if(!r&&!o)throw new _n(t);const s={cadence:e.voucher.cadence,refBlock:e.voucher.refBlock,computeLimit:e.voucher.computeLimit,arguments:e.voucher.arguments,proposalKey:_({},e.voucher.proposalKey,{address:B(e.voucher.proposalKey.address)}),payer:B(e.voucher.payer),authorizers:e.voucher.authorizers.map(B),payloadSigs:e.voucher.payloadSigs.map(e=>_({},e,{address:B(e.address)}))};return r?Kt(s):Ut(s)};function Cn(e,t){return console.warn('\n      %cFCL/SDK Deprecation Notice\n      ============================\n  \n      "latestBlock()" is deprecated, please use "block()" for this and future versions of FCL\n      You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0008-deprecate-latest-block-method\n  \n      ============================\n    ',"font-weight:bold;font-family:monospace;"),Ln([kt(e)],t).then(Tt)}function Dn(e,t){return Ln([It(e)],t).then(Tt)}function Kn({sealed:t=!1,id:n,height:a}={},r={}){return e(!(t&&n||t&&a),'Method: block -- Cannot pass "sealed" with "id" or "height"'),e(!(n&&a),'Method: block -- Cannot pass "id" and "height" simultaneously'),n?Ln([kt(),zn(n)],r).then(Tt):a?Ln([kt(),Fn(a)],r).then(Tt):Ln([kt(t)],r).then(Tt)}function Un(e=[]){return Ee(e.map(e=>$(e,{role:"authorizer"})))}function Rn(e,t,n,a){return{addr:e,signingFunction:t,keyId:n,sequenceNum:a}}function Pn(e){return Ne("ix.validators",t=>Array.isArray(t)?t.push(e):[e])}function Fn(e){return Ee([t=>(t.block.height=e,t),Pn(e=>{if("boolean"==typeof e.block.isSealed)throw new Error("Unable to specify both block height and isSealed.");if(e.block.id)throw new Error("Unable to specify both block height and block id.");return e})])}function zn(e){return Ee([t=>(t.block.id=e,z(t)),Pn((e,{Ok:t,Bad:n})=>le(e)?n(e,"Unable to specify a block id with a Get Account interaction."):"boolean"==typeof e.block.isSealed?n(e,"Unable to specify both block id and isSealed."):e.block.height?n(e,"Unable to specify both block id and block height."):t(e))])}function Hn(e,t,n){return void 0===t&&void 0===n||console.warn("\n      %cFCL/SDK Deprecation Notice\n      ============================\n  \n      Passing a start and end into getEnvents has been deprecated and will not be supported in future versions of the Flow JS-SDK/FCL.\n      You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0005-deprecate-start-end-get-events-builder\n  \n      ============================\n    ","font-weight:bold;font-family:monospace;"),Ee([X,a=>(a.events.eventType=e,a.events.start=t,a.events.end=n,z(a))])}function jn(e,t,n){return Ee([X,a=>(a.events.eventType=e,a.events.start=t,a.events.end=n,z(a))])}function $n(e,t=[]){return Ee([X,n=>(n.events.eventType=e,n.events.blockIds=t,z(n))])}function qn(e=null){return Ee([ae,t=>(t.block.isSealed=e,z(t))])}function Mn(e=!1){return console.warn("\n    %cFCL/SDK Deprecation Notice\n    ============================\n\n    The getLatestBlock builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0006-deprecate-get-latest-block-builder\n\n    ============================\n  ","font-weight:bold;font-family:monospace;"),Ee([Z,t=>(t.block.isSealed=e,z(t))])}function Jn(e){return console.warn("\n    %cFCL/SDK Deprecation Notice\n    ============================\n\n    The getBlockById builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0004-deprecate-get-block-by-id-builder\n\n    ============================\n  ","font-weight:bold;font-family:monospace;"),Ee([Q,t=>(t.block.ids=[e],z(t))])}function Wn(e){return console.warn("\n    %cFCL/SDK Deprecation Notice\n    ============================\n\n    The getBlockByHeight builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0003-deprecate-get-block-by-height-builder\n\n    ============================\n  ","font-weight:bold;font-family:monospace;"),Ee([ee,t=>(t.block.height=e,z(t))])}function Yn(e=null){return Ee([re,t=>(t.collection.id=e,t)])}function Vn(e){return Ee([W,t=>(t.transaction.id=e,z(t))])}function Xn(e){return Ee([Y,t=>(t.transaction.id=e,z(t))])}function Zn(e){return t=>(t.message.computeLimit=e,t)}function Qn(e=[]){return Ee(e.map(q))}function ea(e,t){return{value:e,xform:t}}async function ta(e){return $(e,{role:"proposer"})}async function na(e){return $(e,{role:"payer"})}function aa(){return te}function ra(e){return Ee([t=>(t.message.refBlock=e,z(t))])}function oa(...e){return Ee([M,Te("ix.cadence",G(...e))])}const sa=[];function ca(...e){return Ee([J,Te("ix.cadence",G(...e)),e=>(e.message.computeLimit=e.message.computeLimit||10,e.message.refBlock=e.message.refBlock||null,e.authorizations=e.authorizations||sa,z(e))])}function ia(...e){if(e.length>1){const[t,n]=e;return ia((e,{Ok:a,Bad:r})=>t?a(e):r(e,n))}const[t]=e;return e=>t(e,{Ok:z,Bad:H})}const ua=({node:e})=>async t=>{if(!ie(t))return z(t);if(t.accounts[t.proposer].sequenceNum)return z(t);const n=await ht(await Le([It(t.accounts[t.proposer].addr)]),{node:e}),a=await Tt(n);return t.accounts[t.proposer].sequenceNum=a.keys[t.accounts[t.proposer].keyId].sequenceNumber,z(t)},da=e=>e,la=["tempId"];function ga(e){return["SIGNATURE",e.addr,e.keyId].join(".")}function pa(e={}){return function(t){const n=_({},t,e,{signingFunction:e.signingFunction||t.signingFunction||function(e){return{addr:n.addr,keyId:n.keyId,signature:ga(n)}}});return n}}const fa={proposer:!1,authorizer:!1,payer:!1};var ma={__proto__:null,mockSend:function(t=da){return async function(n){switch(n=await n,!0){case le(n):return function(t,n=5){return e(t.account,"mockAccountResponse(ix) -- ix.account is missing",t),e(t.account.addr,"mockAccountResponse(ix) -- ix.account.addr is missing",t),{account:{addr:t.account.addr,keys:Array.from({length:n},(e,t)=>({index:t,sequenceNumber:42}))}}}(n);case he(n):return{tag:"GET_BLOCK",block:{id:"32"}};default:return t(n)}}},authzFn:pa,authzResolve:function(e={}){return function(t){const{tempId:n}=e;return _({},t,{tempId:n||"WITH_RESOLVE",resolve:pa(function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t.indexOf(n=o[a])>=0||(r[n]=e[n]);return r}(e,la))})}},authzResolveMany:function(e={}){return function(t){return _({},t,{tempId:e.tempId||"AUTHZ_RESOLVE_MANY",resolve:()=>[e.proposer&&pa(e.proposer)({role:_({},fa,{proposer:!0})}),...e.authorizations.map(pa).map(e=>e({role:_({},fa,{authorizer:!0})})),e.payer&&pa(e.payer)({role:_({},fa,{payer:!0})})].filter(Boolean)})}},sig:ga,idof:e=>`${e.addr}-${e.keyId}`,run:(e=[])=>Le([ra("123"),...e]).then(xn)};const ya="0.0.56",ha=e=>{(({name:e,transitionsPath:t})=>{console.error(`\n    %cFCL/SDK Deprecation Notice\n    ============================\n    The ${e} builder has been removed from the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: ${t}\n    ============================\n  `,"font-weight:bold;font-family:monospace;")})({name:"params",transitionsPath:"https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0001-deprecate-params"})},ka=e=>(({name:e,transitionsPath:t})=>{console.warn(`\n    %cFCL/SDK Deprecation Notice\n    ============================\n    The ${e} builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: ${t}\n    ============================\n  `,"font-weight:bold;font-family:monospace;")})({name:"param",transitionsPath:"https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0001-deprecate-params"});export{ma as TestUtils,ya as VERSION,Dn as account,ea as arg,Qn as args,Fn as atBlockHeight,zn as atBlockId,Rn as authorization,Un as authorizations,Kn as block,Le as build,Me as config,hn as createSignableVoucher,Gn as decode,xe as destroy,On as encodeMessageFromSignable,Ae as get,It as getAccount,kt as getBlock,Wn as getBlockByHeight,Jn as getBlockById,qn as getBlockHeader,Yn as getCollection,Hn as getEvents,jn as getEventsAtBlockHeightRange,$n as getEventsAtBlockIds,Mn as getLatestBlock,Xn as getTransaction,Vn as getTransactionStatus,D as interaction,ia as invariant,be as isBad,le as isGetAccount,he as isGetBlock,me as isGetBlockByHeight,fe as isGetBlockById,ke as isGetBlockHeader,Ie as isGetCollection,ge as isGetEvents,pe as isGetLatestBlock,de as isGetTransaction,ue as isGetTransactionStatus,we as isOk,ye as isPing,ce as isScript,ie as isTransaction,se as isUnknown,Cn as latestBlock,Zn as limit,ka as param,ha as params,na as payer,aa as ping,Ee as pipe,ta as proposer,Te as put,ra as ref,xn as resolve,bn as resolveAccounts,Dt as resolveArguments,Gt as resolveCadence,An as resolveFinalNormalization,ua as resolveProposerSequenceNumber,Nt as resolveRefBlockId,Sn as resolveSignatures,Bn as resolveValidators,oa as script,Ln as send,ca as transaction,Ne as update,Pn as validator,kn as voucherToTxId,Se as why};
//# sourceMappingURL=sdk.modern.js.map
