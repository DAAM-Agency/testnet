!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@onflow/config"),require("@onflow/types"),require("@onflow/fcl"),require("elliptic"),require("sha3")):"function"==typeof define&&define.amd?define(["exports","@onflow/config","@onflow/types","@onflow/fcl","elliptic","sha3"],t):t((n||self).flowCadut={},n.config,n.t,n.fcl,n.elliptic,n.sha3)}(this,function(n,t,e,r,o,c){function i(n){if(n&&n.i)return n;var t=Object.create(null);return n&&Object.keys(n).forEach(function(e){if("default"!==e){var r=Object.getOwnPropertyDescriptor(n,e);Object.defineProperty(t,e,r.get?r:{enumerable:!0,get:function(){return n[e]}})}}),t.default=n,t}var s=i(e),u=i(r);const a={emulator:{FungibleToken:"0xee82856bf20e2aa6",FlowFees:"0xe5a8b7f23e8b548f",FlowStorageFees:"0xf8d6e0586b0a20c7",FlowToken:"0x0ae53cb6e3f42a79"},testnet:{FungibleToken:"0x9a0766d93b6608b7",NonFungibleToken:"0x631e88ae7f1d7c20",FlowClusterQC:"0x9eca2b38b18b5dfe",FlowDKG:"0x9eca2b38b18b5dfe",FlowEpoch:"0x9eca2b38b18b5dfe",FlowIDTableStaking:"0x9eca2b38b18b5dfe",FlowToken:"0x7e60df042a9c0868",LockedTokens:"0x95e019a17d0e23d7",StakingProxy:"0x7aad92e5a0715d21",FlowStakingCollection:"0x95e019a17d0e23d7",FUSD:"0xe223d8a629e49c68"},mainnet:{FungibleToken:"0xf233dcee88fe0abe",NonFungibleToken:"0x1d7e57aa55817448",FlowClusterQC:"0x8624b52f9ddcd04a",FlowDKG:"0x8624b52f9ddcd04a",FlowEpoch:"0x8624b52f9ddcd04a",FlowIDTableStaking:"0x8624b52f9ddcd04a",FlowFees:"0xf919ee77447b7497",FlowToken:"0x1654653399040a61",LockedTokens:"0x8d0e87b65159ae63",StakingProxy:"0x62430cf28c26d095",FlowStakingCollection:"0x8d0e87b65159ae63",FUSD:"0x3c5959b568896393"}},f={emulator:{},testnet:{},mainnet:{}},l=n=>{for(const t of Object.keys(f)){const e=n[t],{name:r}=n;f[t]={...f[t],..."object"==typeof n[t]?e:{[r]:e}}}},d={mainnet:"https://access-mainnet-beta.onflow.org",testnet:"https://access-testnet.onflow.org",emulator:"http://localhost:8080"},m=function(){try{return Promise.resolve(function(){try{return Promise.resolve(t.config().get("ix.env")).then(function(n){return n||"emulator"})}catch(n){return Promise.reject(n)}}()).then(function(n){return{...a[n]||a.emulator,...f[n]||f.emulator}})}catch(n){return Promise.reject(n)}},p=n=>n.split(/\s/).map(n=>n.replace(/\s/g,"")).filter(n=>n.length>0&&"import"!==n&&"from"!==n),h=(n,t)=>{const[e,r]=t;return n[e]=r,n},g=n=>n&&0!==n.length?n.split("\n").filter(n=>n.includes("import")).map(p).reduce(h,{}):{},w=(n,t={})=>{const e=g(n),r=[];for(const n in e)!t[n]&&Object.prototype.hasOwnProperty.call(e,n)&&r.push(n);return r},P=(n=[],t="")=>{const e="Missing imports for contracts:";console.error(t?`${t} ${e}`:e,n)},y=/(\s*import\s*)([\w\d]+)(\s+from\s*)([\w\d".\\/]+)/g,x=(n,t,e=!0)=>n.replace(y,(n,r,o,c,i)=>{const s=e?o:i;return`${r}${o} from ${(t instanceof Function?t(s):t[s])||i}`}),b=["public","private","storage"],v=n=>{const[t]=n.split("");return t.toUpperCase()+n.slice(1)},k=n=>{switch(!0){case n.indexOf("//")>=0:return"//";case n.indexOf("/")>=0:return"/";case n.indexOf("\\")>=0:return"\\";default:return""}},F=n=>n.replace(/\s+/g," "),$="contract",S="transaction",T="script",E=n=>n.split(",").map(n=>n.replace(/\s*/g,"")).filter(n=>""!==n),I=n=>n.replace(/(\/\*[\s\S]*?\*\/)|(\/\/.*)/g,""),N=(n,t)=>{const e=I(n),r=F(e.replace(/[\n\r]/g,""));if(r){const n=new RegExp(t,"g").exec(r);if(n)return""===n[1]?[]:E(n[1])}return[]},j=n=>N(n,"(?:prepare\\s*\\(\\s*)([^\\)]*)(?:\\))"),A=n=>N(n,"(?:fun\\s+main\\s*\\(\\s*)([^\\)]*)(?:\\))"),B=n=>N(n,"(?:transaction\\s*\\(\\s*)([^\\)]*)(?:\\))"),q=n=>{const t=I(n).replace(/(resource|struct)\s+\w+\s*{[\s\S]+?}/g,""),e=/(?:access\(\w+\)|pub)\s+contract\s+(?:interface)*\s*(\w*)(\s*{[.\s\S]*init\s*\((.*?)\)[.\s\S]*})?/g.exec(t);if(!e||e.length<2)throw new Error("Contract Error: can't find name of the contract");return{contractName:e[1],args:e[3]||""}},C=n=>{const t=I(n);if(/transaction\s*(\(\s*\))*\s*/g.test(t)){const n=j(t),e=B(t);return{type:S,signers:n.length,args:e}}if(/pub\s+fun\s+main\s*/g.test(t)){const n=A(t);return{type:T,args:n}}if(/\w+\s+contract\s+(\w*\s*)\w*/g.test(t)){const{contractName:n,args:e}=q(t);return{type:$,signers:1,args:e,contractName:n}}return{type:"unknown"}},D=n=>!n||"string"!=typeof n,O=n=>!D(n)&&(n.startsWith("Int")||n.startsWith("UInt")||n.startsWith("Word")),L=n=>{if(D(n))return!1;const t=n.replace(/\s/g,"");return t.startsWith("[")&&t.endsWith("]")},U=n=>{if(D(n))return!1;const t=n.replace(/\s/g,"");return t.startsWith("{")&&t.endsWith("}")},K=n=>L(n)||U(n);function M(n,t,e){if(!n.s){if(e instanceof R){if(!e.s)return void(e.o=M.bind(null,n,t));1&t&&(t=e.s),e=e.v}if(e&&e.then)return void e.then(M.bind(null,n,t),M.bind(null,n,2));n.s=t,n.v=e;const r=n.o;r&&r(n)}}const R=function(){function n(){}return n.prototype.then=function(t,e){const r=new n,o=this.s;if(o){const n=1&o?t:e;if(n){try{M(r,1,n(this.v))}catch(n){M(r,2,n)}return r}return this}return this.o=function(n){try{const o=n.v;1&n.s?M(r,1,t?t(o):o):e?M(r,1,e(o)):M(r,2,o)}catch(n){M(r,2,n)}},r},n}(),_={ARGUMENT:"argument"},G=function(n){try{return Promise.resolve(r.config().get("ix.plugins")).then(function(t){const e=(t||{})[n];return!!(e&&e.length>0)&&e})}catch(n){return Promise.reject(n)}};function H(n,t,e){if(!n.s){if(e instanceof Q){if(!e.s)return void(e.o=H.bind(null,n,t));1&t&&(t=e.s),e=e.v}if(e&&e.then)return void e.then(H.bind(null,n,t),H.bind(null,n,2));n.s=t,n.v=e;const r=n.o;r&&r(n)}}const Q=function(){function n(){}return n.prototype.then=function(t,e){const r=new n,o=this.s;if(o){const n=1&o?t:e;if(n){try{H(r,1,n(this.v))}catch(n){H(r,2,n)}return r}return this}return this.o=function(n){try{const o=n.v;1&n.s?H(r,1,t?t(o):o):e?H(r,1,e(o)):H(r,2,o)}catch(n){H(r,2,n)}},r},n}(),z=n=>n.split(/(\w+)\s*:\s*([\w{}[\]:\s?]*)/).filter(n=>""!==n).map(n=>n.replace(/\s*/g,"")),W=n=>z(n)[1],J=n=>/{(.*)}/.exec(n)[1].split(/([^:]*):(.*)/).map(n=>n.replace(/\s/g,"")).filter(n=>n),V=n=>/\[(.*)\]/.exec(n)[1].replace(/\s+/g,""),X=n=>!D(n)&&(n.includes("?")?s.Optional(s[(n=>n.slice(0,-1))(n)]):s[n]),Y=n=>{if(K(n))switch(!0){case L(n):{const t=V(n);return s.Array(Y(t))}case U(n):{const[t,e]=J(n),r={key:Y(t),value:Y(e)};return s.Dictionary(r)}default:return X(n)}return X(n)},Z=function(n,t){try{return Promise.resolve(G(_.ARGUMENT)).then(function(e){function r(){let n;const t=Y(c);switch(!0){case(n=>{if(D(n))return!1;let t=n.endsWith("?")?n.slice(0,-1):n;return O(t)||(n=>"String"===n)(t)||(n=>"Character"===n)(t)||(n=>"Bool"===n)(t)})(c):return u.arg(o,t);case(n=>!D(n)&&(n.startsWith("Fix64")||n.startsWith("UFix64")))(c):return null===o?u.arg(null,t):(isNaN(parseFloat(o))&&(n=>{throw new Error("Type Error: Expected proper value for fixed type")})(),u.arg(parseFloat(o).toFixed(8),t));case(n=>"Address"===n||"Address?"===n)(c):{const n=null==(d=o)?null:"0x"+(n=>null==n?null:n.replace(/^0x/,""))(d);return u.arg(n,t)}case(n=>"Path"===n||"Path?"===n)(c):return u.arg((n=>{if(n.startsWith("/")){const t=n.slice(1).split("/");if(2!==t.length)throw Error("Incorrect Path - identifier missing");if(!b.includes(t[0]))throw Error("Incorrect Path - wrong domain");const[e,r]=t;return{domain:e,identifier:r}}throw Error("Incorrect Path - shall start with `/`")})(o),t);case L(c):{function e(e){return n?e:u.arg(o,t)}const r=V(c),i=function(){if(K(r))return Promise.resolve(Promise.all(o.map(function(n){try{return Promise.resolve(Z(r,n)).then(function({value:n}){return n})}catch(n){return Promise.reject(n)}}))).then(function(e){return n=1,u.arg(e,t)})}();return i&&i.then?i.then(e):e(i)}case U(c):{function r(){return u.arg(d,t)}const[n,e]=J(c),d=[],m=Object.keys(o),p=(i=m,s=function(t){function r(){const t=O(n)?parseInt(c):c;d.push({key:t,value:i})}const c=m[t];let i;const s=function(){if(K(e))return Promise.resolve(Z(e,o[c])).then(function(n){i=n.value});i=o[c]}();return s&&s.then?s.then(r):r()},l=-1,function n(t){try{for(;++l<i.length;)if((t=s(l))&&t.then){if(!((e=t)instanceof Q&&1&e.s))return void t.then(n,f||(f=H.bind(null,a=new Q,2)));t=t.v}a?H(a,1,t):a=t}catch(n){H(a||(a=new Q),2,n)}var e}(),a);return p&&p.then?p.then(r):r()}default:throw`${c} is not supported`}var i,s,a,f,l,d}let o=t,c=n;const i=function(){if(e)return Promise.resolve(function(n,t){try{function e(){return{type:u,value:a}}let u=n.type,a=n.value;const f=(r=t,o=function(n){const{resolver:e}=t[n];return Promise.resolve(e(u,a)).then(function(n){u=n.type,a=n.value})},s=-1,function n(t){try{for(;++s<r.length;)if((t=o(s))&&t.then){if(!((e=t)instanceof R&&1&e.s))return void t.then(n,i||(i=M.bind(null,c=new R,2)));t=t.v}c?M(c,1,t):c=t}catch(n){M(c||(c=new R),2,n)}var e}(),c);return Promise.resolve(f&&f.then?f.then(e):e())}catch(n){return Promise.reject(n)}var r,o,c,i,s}({type:n,value:t},e)).then(function(n){o=n.value,c=n.type})}();return i&&i.then?i.then(r):r()})}catch(n){return Promise.reject(n)}},nn=function(n=[],t){try{if(n.length>t.length)throw new Error("Not enough arguments");return Promise.all(t.map(function(t,e){try{return Promise.resolve(Z(n[e],t)).then(function(n){var t;return(t=n).xform.asArgument(t.value),n})}catch(n){return Promise.reject(n)}}))}catch(n){return Promise.reject(n)}},tn=function(n,t=[]){try{const e=C(n).args.map(W);return nn(e,t)}catch(n){return Promise.reject(n)}},en=function(n,t){try{if(0===n.length)return Promise.resolve([]);const e=n[0];return Array.isArray(e)&&e.length>0&&e[e.length-1].asArgument?Promise.resolve((n=>n.reduce((n,t)=>[...n,...((n,t)=>{const e=n[n.length-1];return n.slice(0,-1).map(n=>((n,t)=>u.arg(n,t))(n,e))})(t)],[]))(n)):tn(t,n)}catch(n){return Promise.reject(n)}},rn=23830813,on=n=>null==n?null:n.replace(/^0x/,""),cn=function(){try{return Promise.resolve(r.send([r.getBlock(!0)]).then(r.decode))}catch(n){return Promise.reject(n)}},sn=function(){try{return Promise.resolve(cn()).then(function(n){return n.height})}catch(n){return Promise.reject(n)}},un=n=>{const{address:t,contractName:e,eventName:r}=n;return`A.${on(t)}.${e}.${r}`},an=function(n,t){try{function e(){return c<rn&&(console.warn(`"to" value of range is lower than current spork root. setting to ${rn}`),c=rn),o<rn&&(console.warn(`"from" value of range is lower than current spork root. setting to ${rn}`),o=rn),r.send([r.getEventsAtBlockHeightRange(un(n),o,c)]).then(r.decode)}if(!n.address)throw"contract shall have address field";if(!n.contractName)throw"contract shall have contractName field";if(!n.eventName)throw"contract shall have event name";let o,c;const i=function(){if(t){function n(){t.from||(o=c-249)}c=t.to,o=t.from;const e=function(){if(!t.to)return Promise.resolve(sn()).then(function(n){c=n})}();return e&&e.then?e.then(n):n()}return Promise.resolve(sn()).then(function(n){c=n,o=c-249,o<rn&&(console.warn(`"from" value of range is lower than current spork root. setting to ${rn}`),o=rn)})}();return Promise.resolve(i&&i.then?i.then(e):e())}catch(n){return Promise.reject(n)}},fn=new o.ec("p256"),ln=(n,t)=>{const e=fn.keyFromPrivate(Buffer.from(n,"hex")).sign((n=>{const t=new c.SHA3(256);return t.update(Buffer.from(n,"hex")),t.digest()})(t)),r=e.r.toArrayLike(Buffer,"be",32),o=e.s.toArrayLike(Buffer,"be",32);return Buffer.concat([r,o]).toString("hex")},dn=n=>{if("object"==typeof n){if(void 0===n.privateKey)throw Error("privateKey is required");if(void 0===n.address)throw Error("address is required");void 0===n.keyId&&console.warning(`key index have incorrect format. found '${typeof n.keyId}', required 'num'`);const{address:t,privateKey:e,keyId:r=0}=n;return((n,t,e=0)=>function(r={}){try{n=on(n);const o=function(r){try{return Promise.resolve({keyId:e,addr:(o=n,null==o?null:"0x"+on(o)),signature:ln(t,r.message)})}catch(n){return Promise.reject(n)}var o};return Promise.resolve({...r,tempId:`${n}-${e}`,addr:u.sansPrefix(n),keyId:e,signingFunction:o})}catch(n){return Promise.reject(n)}})(t,e,r)}return n};function mn(n,t){try{var e=n()}catch(n){return t(n)}return e&&e.then?e.then(void 0,t):e}const pn=function(n,e){try{const{code:r,cadence:o,args:c,addressMap:i,limit:s,processed:a}=n,f=r||o;return Promise.resolve(m()).then(function(r){function o(){return Promise.resolve(t.config().get("ix.executionLimit")).then(function(t){if(m.push(u.limit(s||t||100)),"transaction"===e){const{proposer:t,payer:e,signers:r=[]}=n,o=0===r.length?[e]:r,c=t||e;m.push(u.payer(dn(e))),m.push(u.proposer(dn(c))),m.push(u.authorizations(o.map(dn)))}return u.send(m)})}const l={...r,...i},d=a?f:x(f,l),m="script"===e?[u.script(d)]:[u.transaction(d)],p=function(){if(c)return Promise.resolve(en(c,f)).then(function(n){m.push(u.args(n))})}();return p&&p.then?p.then(o):o()})}catch(n){return Promise.reject(n)}},hn=function(n){const{raw:t=!1}=n;return Promise.resolve(mn(function(){return Promise.resolve(pn(n,"script")).then(function(n){return t?[n.encodedData,null]:Promise.resolve(u.decode(n)).then(function(n){return[n,null]})})},function(n){return[null,n]}))},gn=function(n){const{wait:t="seal"}=n;return Promise.resolve(mn(function(){return Promise.resolve(pn(n,"transaction")).then(function(n){let e;function r(t){return e?t:[n.transactionId,null]}const o=function(){if(t){const r=(n=>{if("string"==typeof n){const t=n.toLowerCase();if(t.includes("final"))return"onceFinalized";if(t.includes("exec"))return"onceExecuted";if(t.includes("seal"))return"onceSealed"}return console.log(`⚠️ [33mStatus value [1m[35m"${n}"[33m[2m is not supported. Reverting to [32m"onceSealed"[0m`),"onceSealed"})(t);return Promise.resolve(u.tx(n)[r]()).then(function(t){const r={txId:n,...t};return e=1,[r,null]})}}();return o&&o.then?o.then(r):r(o)})},function(n){return[null,n]}))},wn=function(n){try{const{name:t,to:e,payer:r,proposer:o,code:c,update:i=!1,processed:s=!1,addressMap:u={}}=n,a=s?c:x(c,u),f=i?"\n    transaction(name: String, code: String) {\n      prepare(acct: AuthAccount){\n        let decoded = code.decodeHex()\n        \n        acct.contracts.add(\n          name: name,\n          code: decoded,\n        )\n      }\n    }\n  ":"\n  transaction(name: String, code: String){\n    prepare(acct: AuthAccount){\n      let decoded = code.decodeHex()\n      \n      if acct.contracts.get(name: name) == nil {\n        acct.contracts.add(name: name, code: decoded)\n      } else {\n        acct.contracts.update__experimental(name: name, code: decoded)\n      }\n    }\n  }\n",l=Buffer.from(a,"utf8").toString("hex");let d=e,m=e;return r&&(m=r,d=o||r),gn({payer:m,proposer:d,signers:[e],code:f,args:[t,l]})}catch(n){return Promise.reject(n)}};n.CONTRACT=$,n.CURRENT_SPORK_NUMBER=16,n.CURRENT_SPORK_ROOT=rn,n.PLUGIN_TYPES=_,n.SCRIPT=T,n.TRANSACTION=S,n.argType=W,n.capitalizeFirstLetter=v,n.collapseSpaces=F,n.deployContract=wn,n.executeScript=hn,n.extendEnvironment=l,n.extract=N,n.extractContractName=n=>q(n).contractName,n.extractContractParameters=q,n.extractImports=g,n.extractScriptArguments=A,n.extractSigners=j,n.extractTransactionArguments=B,n.findLatestEvents=function(n,t={}){try{function e(t){let e=t-r;return t<s&&(console.warn(`"to" value of range is lower than current spork root. setting to ${rn}`),t=s),e<s&&(console.warn(`"from" value of range is lower than current spork root. setting to ${rn}`),e=s),new Promise((c,s)=>{const a=function(){try{const f=function(s,f){try{var l=(console.log(`${e} -> ${t}...`),Promise.resolve(an(n,{from:e,to:t})).then(function(n){0!==n.length?(clearInterval(void 0),c({events:n})):(u>i&&c({events:n,latestBlock:t}),t=e,e-=r,u+=r,setTimeout(a,o))}))}catch(n){return f(n)}return l&&l.then?l.then(void 0,f):l}(0,function(n){s({events:[],err:n,latestBlock:t})});return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(n){return Promise.reject(n)}};setTimeout(a,o)})}const{step:r=200,delay:o=500,start:c=null,maxRange:i=Infinity,sporkLimit:s=rn}=t;let u=r;return Promise.resolve(c?e(c):Promise.resolve(sn()).then(e))}catch(n){return Promise.reject(n)}},n.generateSchema=E,n.getArrayType=V,n.getChainHeight=sn,n.getDictionaryTypes=J,n.getEnvironment=m,n.getEventName=un,n.getEventsInRange=an,n.getLatestBlock=cn,n.getPlugins=G,n.getPragmaNotes=n=>n.match(/\/{3}\s*pragma\s*(.*)/g).reduce((n,t)=>{const e=t.match(/\/{3}\s*pragma\s+(\w*)\s+(.*)/),[,r,o]=e;return n[r]=o,n},{}),n.getSplitCharacter=k,n.getTemplateInfo=C,n.mapArgument=Z,n.mapArguments=nn,n.mapValuesToCode=tn,n.missingImports=w,n.mutate=gn,n.query=hn,n.registerPlugin=function(n){try{const{type:t}=n;return Promise.resolve(r.config().get("ix.plugins")).then(function(e){const o=e||{},c=o[t]||[];return Promise.resolve(r.config().put("ix.plugins",{...o,[t]:[...c,n]})).then(function(){})})}catch(n){return Promise.reject(n)}},n.replaceImportAddresses=x,n.report=P,n.reportArguments=(n,t,e="")=>{if(t>n){const r=`Incorrect number of arguments: found ${n} of ${t}`;console.error(e?`${e} ${r}`:r)}},n.reportMissing=(n="items",t,e,r="")=>{if(e!==t){const o=`Incorrect number of ${n}: found ${t} of ${e}`;console.error(r?`${r} ${o}`:o)}},n.reportMissingImports=(n,t,e="")=>{const r=w(n,t);r.length>0&&P(r,e)},n.resolveArguments=en,n.sendTransaction=gn,n.setEnvironment=function(n="emulator",e={}){try{const r=n.toLowerCase();if(!a[r])throw new Error(`Provided value "${r}" is not supported. Try "emulator", "testnet" or "mainnet". Default: "emulator"`);const{port:o,endpoint:c,limit:i,extend:s}=e,u="emulator"===r&&o?`http://localhost:${o}`:d[r],f=c||u;return Promise.resolve(t.config().put("ix.env",r)).then(function(){function n(){return s&&l(s),Promise.resolve(t.config().put("accessNode.api",f)).then(function(){})}const e=function(){if(i)return Promise.resolve(t.config().put("ix.executionLimit",i)).then(function(){})}();return e&&e.then?e.then(n):n()})}catch(n){return Promise.reject(n)}},n.splitArgs=z,n.stripComments=I,n.trimAndSplit=(n,t,e)=>e?n.replace(t,"").split(e):n.replace(t,"").split(k(n)),n.underscoreToCamelCase=n=>n.replace(/-/g,"_").split("_").map((n,t)=>t>0?v(n):n).join(""),n.updateContract=function(n){try{return wn({...n,update:!0})}catch(n){return Promise.reject(n)}}});
//# sourceMappingURL=main.umd.js.map
