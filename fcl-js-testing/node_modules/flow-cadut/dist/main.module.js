import{config as t}from"@onflow/config";import*as n from"@onflow/types";import*as r from"@onflow/fcl";import{config as e,send as o,getBlock as c,decode as i,getEventsAtBlockHeightRange as s}from"@onflow/fcl";import{ec as u}from"elliptic";import{SHA3 as a}from"sha3";const f={emulator:{FungibleToken:"0xee82856bf20e2aa6",FlowFees:"0xe5a8b7f23e8b548f",FlowStorageFees:"0xf8d6e0586b0a20c7",FlowToken:"0x0ae53cb6e3f42a79"},testnet:{FungibleToken:"0x9a0766d93b6608b7",NonFungibleToken:"0x631e88ae7f1d7c20",FlowClusterQC:"0x9eca2b38b18b5dfe",FlowDKG:"0x9eca2b38b18b5dfe",FlowEpoch:"0x9eca2b38b18b5dfe",FlowIDTableStaking:"0x9eca2b38b18b5dfe",FlowToken:"0x7e60df042a9c0868",LockedTokens:"0x95e019a17d0e23d7",StakingProxy:"0x7aad92e5a0715d21",FlowStakingCollection:"0x95e019a17d0e23d7",FUSD:"0xe223d8a629e49c68"},mainnet:{FungibleToken:"0xf233dcee88fe0abe",NonFungibleToken:"0x1d7e57aa55817448",FlowClusterQC:"0x8624b52f9ddcd04a",FlowDKG:"0x8624b52f9ddcd04a",FlowEpoch:"0x8624b52f9ddcd04a",FlowIDTableStaking:"0x8624b52f9ddcd04a",FlowFees:"0xf919ee77447b7497",FlowToken:"0x1654653399040a61",LockedTokens:"0x8d0e87b65159ae63",StakingProxy:"0x62430cf28c26d095",FlowStakingCollection:"0x8d0e87b65159ae63",FUSD:"0x3c5959b568896393"}},l={emulator:{},testnet:{},mainnet:{}},m=t=>{for(const n of Object.keys(l)){const r=t[n],{name:e}=t;l[n]={...l[n],..."object"==typeof t[n]?r:{[e]:r}}}},d={mainnet:"https://access-mainnet-beta.onflow.org",testnet:"https://access-testnet.onflow.org",emulator:"http://localhost:8080"},p=function(){try{return Promise.resolve(function(){try{return Promise.resolve(t().get("ix.env")).then(function(t){return t||"emulator"})}catch(t){return Promise.reject(t)}}()).then(function(t){return{...f[t]||f.emulator,...l[t]||l.emulator}})}catch(t){return Promise.reject(t)}},h=function(n="emulator",r={}){try{const e=n.toLowerCase();if(!f[e])throw new Error(`Provided value "${e}" is not supported. Try "emulator", "testnet" or "mainnet". Default: "emulator"`);const{port:o,endpoint:c,limit:i,extend:s}=r,u="emulator"===e&&o?`http://localhost:${o}`:d[e],a=c||u;return Promise.resolve(t().put("ix.env",e)).then(function(){function n(){return s&&m(s),Promise.resolve(t().put("accessNode.api",a)).then(function(){})}const r=function(){if(i)return Promise.resolve(t().put("ix.executionLimit",i)).then(function(){})}();return r&&r.then?r.then(n):n()})}catch(t){return Promise.reject(t)}},g=t=>t.split(/\s/).map(t=>t.replace(/\s/g,"")).filter(t=>t.length>0&&"import"!==t&&"from"!==t),w=(t,n)=>{const[r,e]=n;return t[r]=e,t},P=t=>t&&0!==t.length?t.split("\n").filter(t=>t.includes("import")).map(g).reduce(w,{}):{},y=(t,n={})=>{const r=P(t),e=[];for(const t in r)!n[t]&&Object.prototype.hasOwnProperty.call(r,t)&&e.push(t);return e},x=(t=[],n="")=>{const r="Missing imports for contracts:";console.error(n?`${n} ${r}`:r,t)},v=(t,n,r="")=>{const e=y(t,n);e.length>0&&x(e,r)},b=/(\s*import\s*)([\w\d]+)(\s+from\s*)([\w\d".\\/]+)/g,k=(t,n,r=!0)=>t.replace(b,(t,e,o,c,i)=>{const s=r?o:i;return`${e}${o} from ${(n instanceof Function?n(s):n[s])||i}`}),F=["public","private","storage"],$=t=>{const[n]=t.split("");return n.toUpperCase()+t.slice(1)},S=t=>t.replace(/-/g,"_").split("_").map((t,n)=>n>0?$(t):t).join(""),E=(t,n,r)=>r?t.replace(n,"").split(r):t.replace(n,"").split(I(t)),I=t=>{switch(!0){case t.indexOf("//")>=0:return"//";case t.indexOf("/")>=0:return"/";case t.indexOf("\\")>=0:return"\\";default:return""}},T=t=>t.replace(/\s+/g," "),N="contract",A="transaction",B="script",C=t=>t.split(",").map(t=>t.replace(/\s*/g,"")).filter(t=>""!==t),D=t=>t.replace(/(\/\*[\s\S]*?\*\/)|(\/\/.*)/g,""),j=(t,n)=>{const r=D(t),e=T(r.replace(/[\n\r]/g,""));if(e){const t=new RegExp(n,"g").exec(e);if(t)return""===t[1]?[]:C(t[1])}return[]},L=t=>j(t,"(?:prepare\\s*\\(\\s*)([^\\)]*)(?:\\))"),U=t=>j(t,"(?:fun\\s+main\\s*\\(\\s*)([^\\)]*)(?:\\))"),q=t=>j(t,"(?:transaction\\s*\\(\\s*)([^\\)]*)(?:\\))"),K=t=>M(t).contractName,M=t=>{const n=D(t).replace(/(resource|struct)\s+\w+\s*{[\s\S]+?}/g,""),r=/(?:access\(\w+\)|pub)\s+contract\s+(?:interface)*\s*(\w*)(\s*{[.\s\S]*init\s*\((.*?)\)[.\s\S]*})?/g.exec(n);if(!r||r.length<2)throw new Error("Contract Error: can't find name of the contract");return{contractName:r[1],args:r[3]||""}},R=t=>{const n=D(t);if(/transaction\s*(\(\s*\))*\s*/g.test(n)){const t=L(n),r=q(n);return{type:"transaction",signers:t.length,args:r}}if(/pub\s+fun\s+main\s*/g.test(n))return{type:"script",args:U(n)};if(/\w+\s+contract\s+(\w*\s*)\w*/g.test(n)){const{contractName:t,args:r}=M(n);return{type:"contract",signers:1,args:r,contractName:t}}return{type:"unknown"}},_=t=>t.match(/\/{3}\s*pragma\s*(.*)/g).reduce((t,n)=>{const r=n.match(/\/{3}\s*pragma\s+(\w*)\s+(.*)/),[,e,o]=r;return t[e]=o,t},{}),G=t=>!t||"string"!=typeof t,O=t=>!G(t)&&(t.startsWith("Int")||t.startsWith("UInt")||t.startsWith("Word")),H=t=>{if(G(t))return!1;const n=t.replace(/\s/g,"");return n.startsWith("[")&&n.endsWith("]")},Q=t=>{if(G(t))return!1;const n=t.replace(/\s/g,"");return n.startsWith("{")&&n.endsWith("}")},z=t=>H(t)||Q(t);function W(t,n,r){if(!t.s){if(r instanceof J){if(!r.s)return void(r.o=W.bind(null,t,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(W.bind(null,t,n),W.bind(null,t,2));t.s=n,t.v=r;const e=t.o;e&&e(t)}}const J=function(){function t(){}return t.prototype.then=function(n,r){const e=new t,o=this.s;if(o){const t=1&o?n:r;if(t){try{W(e,1,t(this.v))}catch(t){W(e,2,t)}return e}return this}return this.o=function(t){try{const o=t.v;1&t.s?W(e,1,n?n(o):o):r?W(e,1,r(o)):W(e,2,o)}catch(t){W(e,2,t)}},e},t}(),V={ARGUMENT:"argument"},X=function(t){try{const{type:n}=t;return Promise.resolve(e().get("ix.plugins")).then(function(r){const o=r||{},c=o[n]||[];return Promise.resolve(e().put("ix.plugins",{...o,[n]:[...c,t]})).then(function(){})})}catch(t){return Promise.reject(t)}},Y=function(t){try{return Promise.resolve(e().get("ix.plugins")).then(function(n){const r=(n||{})[t];return!!(r&&r.length>0)&&r})}catch(t){return Promise.reject(t)}};function Z(t,n,r){if(!t.s){if(r instanceof tt){if(!r.s)return void(r.o=Z.bind(null,t,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(Z.bind(null,t,n),Z.bind(null,t,2));t.s=n,t.v=r;const e=t.o;e&&e(t)}}const tt=function(){function t(){}return t.prototype.then=function(n,r){const e=new t,o=this.s;if(o){const t=1&o?n:r;if(t){try{Z(e,1,t(this.v))}catch(t){Z(e,2,t)}return e}return this}return this.o=function(t){try{const o=t.v;1&t.s?Z(e,1,n?n(o):o):r?Z(e,1,r(o)):Z(e,2,o)}catch(t){Z(e,2,t)}},e},t}(),nt=t=>t.split(/(\w+)\s*:\s*([\w{}[\]:\s?]*)/).filter(t=>""!==t).map(t=>t.replace(/\s*/g,"")),rt=t=>nt(t)[1],et=t=>/{(.*)}/.exec(t)[1].split(/([^:]*):(.*)/).map(t=>t.replace(/\s/g,"")).filter(t=>t),ot=t=>/\[(.*)\]/.exec(t)[1].replace(/\s+/g,""),ct=(t,n,r="")=>{if(n>t){const e=`Incorrect number of arguments: found ${t} of ${n}`;console.error(r?`${r} ${e}`:e)}},it=(t="items",n,r,e="")=>{if(r!==n){const o=`Incorrect number of ${t}: found ${n} of ${r}`;console.error(e?`${e} ${o}`:o)}},st=t=>!G(t)&&(t.includes("?")?n.Optional(n[(t=>t.slice(0,-1))(t)]):n[t]),ut=t=>{if(z(t))switch(!0){case H(t):{const r=ot(t);return n.Array(ut(r))}case Q(t):{const[r,e]=et(t),o={key:ut(r),value:ut(e)};return n.Dictionary(o)}default:return st(t)}return st(t)},at=function(t,n){try{return Promise.resolve(Y(V.ARGUMENT)).then(function(e){function o(){let t;const n=ut(i);switch(!0){case(t=>{if(G(t))return!1;let n=t.endsWith("?")?t.slice(0,-1):t;return O(n)||(t=>"String"===t)(n)||(t=>"Character"===t)(n)||(t=>"Bool"===t)(n)})(i):return r.arg(c,n);case(t=>!G(t)&&(t.startsWith("Fix64")||t.startsWith("UFix64")))(i):return null===c?r.arg(null,n):(isNaN(parseFloat(c))&&(t=>{throw new Error("Type Error: Expected proper value for fixed type")})(),r.arg(parseFloat(c).toFixed(8),n));case(t=>"Address"===t||"Address?"===t)(i):{const t=null==(m=c)?null:"0x"+(t=>null==t?null:t.replace(/^0x/,""))(m);return r.arg(t,n)}case(t=>"Path"===t||"Path?"===t)(i):return r.arg((t=>{if(t.startsWith("/")){const n=t.slice(1).split("/");if(2!==n.length)throw Error("Incorrect Path - identifier missing");if(!F.includes(n[0]))throw Error("Incorrect Path - wrong domain");const[r,e]=n;return{domain:r,identifier:e}}throw Error("Incorrect Path - shall start with `/`")})(c),n);case H(i):{function e(e){return t?e:r.arg(c,n)}const o=ot(i),s=function(){if(z(o))return Promise.resolve(Promise.all(c.map(function(t){try{return Promise.resolve(at(o,t)).then(function({value:t}){return t})}catch(t){return Promise.reject(t)}}))).then(function(e){return t=1,r.arg(e,n)})}();return s&&s.then?s.then(e):e(s)}case Q(i):{function o(){return r.arg(m,n)}const[t,e]=et(i),m=[],d=Object.keys(c),p=(s=d,u=function(n){function r(){const n=O(t)?parseInt(o):o;m.push({key:n,value:i})}const o=d[n];let i;const s=function(){if(z(e))return Promise.resolve(at(e,c[o])).then(function(t){i=t.value});i=c[o]}();return s&&s.then?s.then(r):r()},l=-1,function t(n){try{for(;++l<s.length;)if((n=u(l))&&n.then){if(!((r=n)instanceof tt&&1&r.s))return void n.then(t,f||(f=Z.bind(null,a=new tt,2)));n=n.v}a?Z(a,1,n):a=n}catch(t){Z(a||(a=new tt),2,t)}var r}(),a);return p&&p.then?p.then(o):o()}default:throw`${i} is not supported`}var s,u,a,f,l,m}let c=n,i=t;const s=function(){if(e)return Promise.resolve(function(t,n){try{function r(){return{type:u,value:a}}let u=t.type,a=t.value;const f=(e=n,o=function(t){const{resolver:r}=n[t];return Promise.resolve(r(u,a)).then(function(t){u=t.type,a=t.value})},s=-1,function t(n){try{for(;++s<e.length;)if((n=o(s))&&n.then){if(!((r=n)instanceof J&&1&r.s))return void n.then(t,i||(i=W.bind(null,c=new J,2)));n=n.v}c?W(c,1,n):c=n}catch(t){W(c||(c=new J),2,t)}var r}(),c);return Promise.resolve(f&&f.then?f.then(r):r())}catch(t){return Promise.reject(t)}var e,o,c,i,s}({type:t,value:n},e)).then(function(t){c=t.value,i=t.type})}();return s&&s.then?s.then(o):o()})}catch(t){return Promise.reject(t)}},ft=function(t=[],n){try{if(t.length>n.length)throw new Error("Not enough arguments");return Promise.all(n.map(function(n,r){try{return Promise.resolve(at(t[r],n)).then(function(t){var n;return(n=t).xform.asArgument(n.value),t})}catch(t){return Promise.reject(t)}}))}catch(t){return Promise.reject(t)}},lt=function(t,n=[]){try{const r=R(t).args.map(rt);return ft(r,n)}catch(t){return Promise.reject(t)}},mt=function(t,n){try{if(0===t.length)return Promise.resolve([]);const e=t[0];return Array.isArray(e)&&e.length>0&&e[e.length-1].asArgument?Promise.resolve((t=>t.reduce((t,n)=>[...t,...((t,n)=>{const e=t[t.length-1];return t.slice(0,-1).map(t=>((t,n)=>r.arg(t,n))(t,e))})(n)],[]))(t)):lt(n,t)}catch(t){return Promise.reject(t)}},dt=23830813,pt=16,ht=t=>null==t?null:t.replace(/^0x/,""),gt=function(){try{return Promise.resolve(o([c(!0)]).then(i))}catch(t){return Promise.reject(t)}},wt=function(){try{return Promise.resolve(gt()).then(function(t){return t.height})}catch(t){return Promise.reject(t)}},Pt=t=>{const{address:n,contractName:r,eventName:e}=t;return`A.${ht(n)}.${r}.${e}`},yt=function(t,n){try{function r(){return c<dt&&(console.warn(`"to" value of range is lower than current spork root. setting to ${dt}`),c=dt),e<dt&&(console.warn(`"from" value of range is lower than current spork root. setting to ${dt}`),e=dt),o([s(Pt(t),e,c)]).then(i)}if(!t.address)throw"contract shall have address field";if(!t.contractName)throw"contract shall have contractName field";if(!t.eventName)throw"contract shall have event name";let e,c;const u=function(){if(n){function t(){n.from||(e=c-249)}c=n.to,e=n.from;const r=function(){if(!n.to)return Promise.resolve(wt()).then(function(t){c=t})}();return r&&r.then?r.then(t):t()}return Promise.resolve(wt()).then(function(t){c=t,e=c-249,e<dt&&(console.warn(`"from" value of range is lower than current spork root. setting to ${dt}`),e=dt)})}();return Promise.resolve(u&&u.then?u.then(r):r())}catch(t){return Promise.reject(t)}},xt=function(t,n={}){try{function r(n){let r=n-e;return n<s&&(console.warn(`"to" value of range is lower than current spork root. setting to ${dt}`),n=s),r<s&&(console.warn(`"from" value of range is lower than current spork root. setting to ${dt}`),r=s),new Promise((c,s)=>{const a=function(){try{const f=function(s,f){try{var l=(console.log(`${r} -> ${n}...`),Promise.resolve(yt(t,{from:r,to:n})).then(function(t){0!==t.length?(clearInterval(void 0),c({events:t})):(u>i&&c({events:t,latestBlock:n}),n=r,r-=e,u+=e,setTimeout(a,o))}))}catch(t){return f(t)}return l&&l.then?l.then(void 0,f):l}(0,function(t){s({events:[],err:t,latestBlock:n})});return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(t){return Promise.reject(t)}};setTimeout(a,o)})}const{step:e=200,delay:o=500,start:c=null,maxRange:i=Infinity,sporkLimit:s=dt}=n;let u=e;return Promise.resolve(c?r(c):Promise.resolve(wt()).then(r))}catch(t){return Promise.reject(t)}},vt=new u("p256"),bt=(t,n)=>{const r=vt.keyFromPrivate(Buffer.from(t,"hex")).sign((t=>{const n=new a(256);return n.update(Buffer.from(t,"hex")),n.digest()})(n)),e=r.r.toArrayLike(Buffer,"be",32),o=r.s.toArrayLike(Buffer,"be",32);return Buffer.concat([e,o]).toString("hex")},kt=t=>{if("object"==typeof t){if(void 0===t.privateKey)throw Error("privateKey is required");if(void 0===t.address)throw Error("address is required");void 0===t.keyId&&console.warning(`key index have incorrect format. found '${typeof t.keyId}', required 'num'`);const{address:n,privateKey:e,keyId:o=0}=t;return((t,n,e=0)=>function(o={}){try{t=ht(t);const c=function(r){try{return Promise.resolve({keyId:e,addr:(o=t,null==o?null:"0x"+ht(o)),signature:bt(n,r.message)})}catch(t){return Promise.reject(t)}var o};return Promise.resolve({...o,tempId:`${t}-${e}`,addr:r.sansPrefix(t),keyId:e,signingFunction:c})}catch(t){return Promise.reject(t)}})(n,e,o)}return t};function Ft(t,n){try{var r=t()}catch(t){return n(t)}return r&&r.then?r.then(void 0,n):r}const $t=function(n,e){try{const{code:o,cadence:c,args:i,addressMap:s,limit:u,processed:a}=n,f=o||c;return Promise.resolve(p()).then(function(o){function c(){return Promise.resolve(t().get("ix.executionLimit")).then(function(t){if(d.push(r.limit(u||t||100)),"transaction"===e){const{proposer:t,payer:e,signers:o=[]}=n,c=0===o.length?[e]:o,i=t||e;d.push(r.payer(kt(e))),d.push(r.proposer(kt(i))),d.push(r.authorizations(c.map(kt)))}return r.send(d)})}const l={...o,...s},m=a?f:k(f,l),d="script"===e?[r.script(m)]:[r.transaction(m)],p=function(){if(i)return Promise.resolve(mt(i,f)).then(function(t){d.push(r.args(t))})}();return p&&p.then?p.then(c):c()})}catch(t){return Promise.reject(t)}},St=function(t){const{raw:n=!1}=t;return Promise.resolve(Ft(function(){return Promise.resolve($t(t,"script")).then(function(t){return n?[t.encodedData,null]:Promise.resolve(r.decode(t)).then(function(t){return[t,null]})})},function(t){return[null,t]}))},Et=function(t){const{wait:n="seal"}=t;return Promise.resolve(Ft(function(){return Promise.resolve($t(t,"transaction")).then(function(t){let e;function o(n){return e?n:[t.transactionId,null]}const c=function(){if(n){const o=(t=>{if("string"==typeof t){const n=t.toLowerCase();if(n.includes("final"))return"onceFinalized";if(n.includes("exec"))return"onceExecuted";if(n.includes("seal"))return"onceSealed"}return console.log(`⚠️ [33mStatus value [1m[35m"${t}"[33m[2m is not supported. Reverting to [32m"onceSealed"[0m`),"onceSealed"})(n);return Promise.resolve(r.tx(t)[o]()).then(function(n){const r={txId:t,...n};return e=1,[r,null]})}}();return c&&c.then?c.then(o):o(c)})},function(t){return[null,t]}))},It=function(t){try{const{name:n,to:r,payer:e,proposer:o,code:c,update:i=!1,processed:s=!1,addressMap:u={}}=t,a=s?c:k(c,u),f=i?"\n    transaction(name: String, code: String) {\n      prepare(acct: AuthAccount){\n        let decoded = code.decodeHex()\n        \n        acct.contracts.add(\n          name: name,\n          code: decoded,\n        )\n      }\n    }\n  ":"\n  transaction(name: String, code: String){\n    prepare(acct: AuthAccount){\n      let decoded = code.decodeHex()\n      \n      if acct.contracts.get(name: name) == nil {\n        acct.contracts.add(name: name, code: decoded)\n      } else {\n        acct.contracts.update__experimental(name: name, code: decoded)\n      }\n    }\n  }\n",l=Buffer.from(a,"utf8").toString("hex");let m=r,d=r;return e&&(d=e,m=o||e),Et({payer:d,proposer:m,signers:[r],code:f,args:[n,l]})}catch(t){return Promise.reject(t)}},Tt=function(t){try{return It({...t,update:!0})}catch(t){return Promise.reject(t)}};export{N as CONTRACT,pt as CURRENT_SPORK_NUMBER,dt as CURRENT_SPORK_ROOT,V as PLUGIN_TYPES,B as SCRIPT,A as TRANSACTION,rt as argType,$ as capitalizeFirstLetter,T as collapseSpaces,It as deployContract,St as executeScript,m as extendEnvironment,j as extract,K as extractContractName,M as extractContractParameters,P as extractImports,U as extractScriptArguments,L as extractSigners,q as extractTransactionArguments,xt as findLatestEvents,C as generateSchema,ot as getArrayType,wt as getChainHeight,et as getDictionaryTypes,p as getEnvironment,Pt as getEventName,yt as getEventsInRange,gt as getLatestBlock,Y as getPlugins,_ as getPragmaNotes,I as getSplitCharacter,R as getTemplateInfo,at as mapArgument,ft as mapArguments,lt as mapValuesToCode,y as missingImports,Et as mutate,St as query,X as registerPlugin,k as replaceImportAddresses,x as report,ct as reportArguments,it as reportMissing,v as reportMissingImports,mt as resolveArguments,Et as sendTransaction,h as setEnvironment,nt as splitArgs,D as stripComments,E as trimAndSplit,S as underscoreToCamelCase,Tt as updateContract};
//# sourceMappingURL=main.module.js.map
